<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ–ãƒ©ã‚·ãƒ¬ã‚¹ãƒ¢ãƒ¼ã‚¿ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ - ã‚³ã‚¤ãƒ«å·»ãæ–¹ã®å½±éŸ¿ã‚’ä½“æ„Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .panel h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        canvas {
            border-radius: 10px;
            background: white;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .stat-card .unit {
            font-size: 0.9em;
            color: #666;
        }

        .chart-container {
            margin-top: 20px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 5px solid #2196f3;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
        }

        .comparison-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
        }

        .comparison-table tr:hover {
            background: #f5f5f5;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .running-animation {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #4caf50;
            border-radius: 50%;
            margin-left: 10px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ãƒ–ãƒ©ã‚·ãƒ¬ã‚¹ãƒ¢ãƒ¼ã‚¿ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿</h1>
        <p class="subtitle">ã‚³ã‚¤ãƒ«ã®å·»ãæ–¹ãŒãƒ¢ãƒ¼ã‚¿ç‰¹æ€§ã«åŠã¼ã™å½±éŸ¿ã‚’ä½“æ„Ÿã—ã‚ˆã†!</p>

        <div class="main-content">
            <!-- å·¦ãƒ‘ãƒãƒ«: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="panel">
                <h2>âš™ï¸ ãƒ¢ãƒ¼ã‚¿è¨­å®š</h2>
                
                <div class="control-group">
                    <label>å·»ç·šæ–¹å¼</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="concentrated" name="winding" value="concentrated" checked>
                            <label for="concentrated">é›†ä¸­å·»</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="distributed" name="winding" value="distributed">
                            <label for="distributed">åˆ†å¸ƒå·»</label>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label>ã‚³ã‚¤ãƒ«å·»ãæ•°: <span class="value-display" id="turnsValue">100</span>ã‚¿ãƒ¼ãƒ³</label>
                    <input type="range" id="turns" min="50" max="200" value="100" step="10">
                </div>

                <div class="control-group">
                    <label>ã‚³ã‚¤ãƒ«å¯†åº¦: <span class="value-display" id="densityValue">80</span>%</label>
                    <input type="range" id="density" min="50" max="100" value="80" step="5">
                </div>

                <div class="control-group">
                    <label>ã‚¹ãƒ­ãƒƒãƒˆæ•°: <span class="value-display" id="slotsValue">12</span></label>
                    <input type="range" id="slots" min="9" max="18" value="12" step="3">
                </div>

                <div class="control-group">
                    <label>ç£æ¥µæ•°: <span class="value-display" id="polesValue">8</span></label>
                    <input type="range" id="poles" min="4" max="12" value="8" step="2">
                </div>

                <div class="control-group">
                    <label>å›è»¢é€Ÿåº¦: <span class="value-display" id="speedValue">1000</span>rpm</label>
                    <input type="range" id="speed" min="0" max="3000" value="1000" step="100">
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" id="runBtn">â–¶ï¸ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</button>
                    <button class="btn btn-secondary" id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                </div>

                <div class="info-box">
                    <h3>ğŸ’¡ å·»ç·šæ–¹å¼ã«ã¤ã„ã¦</h3>
                    <p><strong>é›†ä¸­å·»:</strong> 1ã¤ã®ãƒ†ã‚£ãƒ¼ã‚¹(æ­¯)ã«ã‚³ã‚¤ãƒ«ã‚’é›†ä¸­ã—ã¦å·»ãæ–¹å¼ã€‚ã‚³ã‚¤ãƒ«ã‚¨ãƒ³ãƒ‰ãŒçŸ­ãã€éŠ…æãŒå°‘ãªã„ã€‚è£½é€ ãŒå®¹æ˜“ã€‚</p>
                    <p style="margin-top: 10px;"><strong>åˆ†å¸ƒå·»:</strong> è¤‡æ•°ã®ãƒ†ã‚£ãƒ¼ã‚¹ã«ã¾ãŸãŒã£ã¦ã‚³ã‚¤ãƒ«ã‚’åˆ†æ•£ã—ã¦å·»ãæ–¹å¼ã€‚èµ·ç£åŠ›åˆ†å¸ƒãŒæ­£å¼¦æ³¢ã«è¿‘ãã€ãƒˆãƒ«ã‚¯ãƒªãƒƒãƒ—ãƒ«ãŒå°ã•ã„ã€‚</p>
                </div>
            </div>

            <!-- å³ãƒ‘ãƒãƒ«: ãƒ¢ãƒ¼ã‚¿æ§‹é€ ã®å¯è¦–åŒ– -->
            <div class="panel">
                <h2>ğŸ¨ ãƒ¢ãƒ¼ã‚¿æ§‹é€ </h2>
                <canvas id="motorCanvas" width="500" height="500"></canvas>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>æ¨å®šãƒˆãƒ«ã‚¯</h3>
                        <div class="value" id="torqueValue">0.85</div>
                        <div class="unit">Nm</div>
                    </div>
                    <div class="stat-card">
                        <h3>åŠ¹ç‡</h3>
                        <div class="value" id="efficiencyValue">88</div>
                        <div class="unit">%</div>
                    </div>
                    <div class="stat-card">
                        <h3>ãƒˆãƒ«ã‚¯ãƒªãƒƒãƒ—ãƒ«</h3>
                        <div class="value" id="rippleValue">5.2</div>
                        <div class="unit">%</div>
                    </div>
                    <div class="stat-card">
                        <h3>éŠ…æ</h3>
                        <div class="value" id="copperLossValue">12</div>
                        <div class="unit">W</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å·»ãæ–¹ã®2Då±•é–‹å›³ -->
        <div class="panel">
            <h2>ğŸ“ ã‚³ã‚¤ãƒ«å·»ãæ–¹ã®2Då±•é–‹å›³</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="chart-container">
                    <h3 style="text-align: center; color: #667eea; margin-bottom: 10px;">é›†ä¸­å·»ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
                    <canvas id="concentratedWindingDiagram" width="500" height="200"></canvas>
                    <p style="text-align: center; margin-top: 10px; color: #666; font-size: 0.9em;">å„ãƒ†ã‚£ãƒ¼ã‚¹ã«ç‹¬ç«‹ã—ã¦ã‚³ã‚¤ãƒ«ã‚’å·»ã</p>
                </div>
                <div class="chart-container">
                    <h3 style="text-align: center; color: #667eea; margin-bottom: 10px;">åˆ†å¸ƒå·»ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
                    <canvas id="distributedWindingDiagram" width="500" height="200"></canvas>
                    <p style="text-align: center; margin-top: 10px; color: #666; font-size: 0.9em;">è¤‡æ•°ã®ãƒ†ã‚£ãƒ¼ã‚¹ã«ã¾ãŸãŒã£ã¦ã‚³ã‚¤ãƒ«ã‚’å·»ã</p>
                </div>
            </div>
            
            <div class="chart-container" style="margin-top: 20px;">
                <h3 style="text-align: center; color: #667eea; margin-bottom: 10px;">ç¾åœ¨ã®è¨­å®šã®å·»ç·šãƒ‘ã‚¿ãƒ¼ãƒ³å±•é–‹å›³</h3>
                <canvas id="currentWindingDiagram" width="1000" height="250"></canvas>
                <p style="text-align: center; margin-top: 10px; color: #666;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: #ff6b6b; margin: 0 5px; vertical-align: middle;"></span>Uç›¸
                    <span style="display: inline-block; width: 20px; height: 20px; background: #4ecdc4; margin: 0 5px; vertical-align: middle;"></span>Vç›¸
                    <span style="display: inline-block; width: 20px; height: 20px; background: #ffe66d; margin: 0 5px; vertical-align: middle;"></span>Wç›¸
                </p>
            </div>
        </div>

        <!-- ä¸‹éƒ¨: ç‰¹æ€§ã‚°ãƒ©ãƒ• -->
        <div class="panel">
            <h2>ğŸ“Š ãƒ¢ãƒ¼ã‚¿ç‰¹æ€§ã‚°ãƒ©ãƒ•</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="chart-container">
                    <h3 style="text-align: center; color: #667eea; margin-bottom: 10px;">ãƒˆãƒ«ã‚¯-é€Ÿåº¦ç‰¹æ€§</h3>
                    <canvas id="torqueSpeedChart" width="500" height="300"></canvas>
                </div>
                <div class="chart-container">
                    <h3 style="text-align: center; color: #667eea; margin-bottom: 10px;">ãƒˆãƒ«ã‚¯ãƒªãƒƒãƒ—ãƒ«æ³¢å½¢</h3>
                    <canvas id="rippleChart" width="500" height="300"></canvas>
                </div>
            </div>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>é …ç›®</th>
                        <th>é›†ä¸­å·»</th>
                        <th>åˆ†å¸ƒå·»</th>
                        <th>ç¾åœ¨ã®è¨­å®š</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ãƒˆãƒ«ã‚¯å¯†åº¦</td>
                        <td>ä¸­</td>
                        <td>é«˜</td>
                        <td id="currentTorqueDensity">ä¸­</td>
                    </tr>
                    <tr>
                        <td>ãƒˆãƒ«ã‚¯ãƒªãƒƒãƒ—ãƒ«</td>
                        <td>å¤§ (8-12%)</td>
                        <td>å° (3-5%)</td>
                        <td id="currentRippleLevel">å¤§</td>
                    </tr>
                    <tr>
                        <td>åŠ¹ç‡</td>
                        <td>é«˜ (90-93%)</td>
                        <td>ä¸­ (85-88%)</td>
                        <td id="currentEfficiencyLevel">é«˜</td>
                    </tr>
                    <tr>
                        <td>è£½é€ é›£æ˜“åº¦</td>
                        <td>æ˜“</td>
                        <td>é›£</td>
                        <td id="currentManufacturing">æ˜“</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let motorConfig = {
            windingType: 'concentrated',
            turns: 100,
            density: 80,
            slots: 12,
            poles: 8,
            speed: 1000,
            isRunning: false,
            rotationAngle: 0
        };

        let animationId = null;

        // DOMè¦ç´ ã®å–å¾—
        const motorCanvas = document.getElementById('motorCanvas');
        const motorCtx = motorCanvas.getContext('2d');
        const torqueSpeedCanvas = document.getElementById('torqueSpeedChart');
        const torqueSpeedCtx = torqueSpeedCanvas.getContext('2d');
        const rippleCanvas = document.getElementById('rippleChart');
        const rippleCtx = rippleCanvas.getContext('2d');

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        document.querySelectorAll('input[name="winding"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                motorConfig.windingType = e.target.value;
                updateSimulation();
            });
        });

        document.getElementById('turns').addEventListener('input', (e) => {
            motorConfig.turns = parseInt(e.target.value);
            document.getElementById('turnsValue').textContent = motorConfig.turns;
            updateSimulation();
        });

        document.getElementById('density').addEventListener('input', (e) => {
            motorConfig.density = parseInt(e.target.value);
            document.getElementById('densityValue').textContent = motorConfig.density;
            updateSimulation();
        });

        document.getElementById('slots').addEventListener('input', (e) => {
            motorConfig.slots = parseInt(e.target.value);
            document.getElementById('slotsValue').textContent = motorConfig.slots;
            updateSimulation();
        });

        document.getElementById('poles').addEventListener('input', (e) => {
            motorConfig.poles = parseInt(e.target.value);
            document.getElementById('polesValue').textContent = motorConfig.poles;
            updateSimulation();
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            motorConfig.speed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = motorConfig.speed;
            updateSimulation();
        });

        document.getElementById('runBtn').addEventListener('click', () => {
            motorConfig.isRunning = !motorConfig.isRunning;
            const btn = document.getElementById('runBtn');
            if (motorConfig.isRunning) {
                btn.innerHTML = 'â¸ï¸ åœæ­¢';
                btn.style.background = '#f44336';
                startAnimation();
            } else {
                btn.innerHTML = 'â–¶ï¸ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ';
                btn.style.background = '#667eea';
                stopAnimation();
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            motorConfig = {
                windingType: 'concentrated',
                turns: 100,
                density: 80,
                slots: 12,
                poles: 8,
                speed: 1000,
                isRunning: false,
                rotationAngle: 0
            };
            document.getElementById('concentrated').checked = true;
            document.getElementById('turns').value = 100;
            document.getElementById('density').value = 80;
            document.getElementById('slots').value = 12;
            document.getElementById('poles').value = 8;
            document.getElementById('speed').value = 1000;
            document.getElementById('turnsValue').textContent = 100;
            document.getElementById('densityValue').textContent = 80;
            document.getElementById('slotsValue').textContent = 12;
            document.getElementById('polesValue').textContent = 8;
            document.getElementById('speedValue').textContent = 1000;
            
            stopAnimation();
            document.getElementById('runBtn').innerHTML = 'â–¶ï¸ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ';
            document.getElementById('runBtn').style.background = '#667eea';
            updateSimulation();
        });

        // ãƒ¢ãƒ¼ã‚¿ã®æç”»
        function drawMotor() {
            const centerX = motorCanvas.width / 2;
            const centerY = motorCanvas.height / 2;
            const outerRadius = 200;
            const innerRadius = 120;
            const rotorRadius = 100;

            motorCtx.clearRect(0, 0, motorCanvas.width, motorCanvas.height);

            // ã‚¹ãƒ†ãƒ¼ã‚¿å¤–å‘¨
            motorCtx.beginPath();
            motorCtx.arc(centerX, centerY, outerRadius, 0, Math.PI * 2);
            motorCtx.fillStyle = '#e0e0e0';
            motorCtx.fill();
            motorCtx.strokeStyle = '#333';
            motorCtx.lineWidth = 2;
            motorCtx.stroke();

            // ã‚¹ãƒ­ãƒƒãƒˆã¨ã‚³ã‚¤ãƒ«ã®æç”»
            const slotAngle = (Math.PI * 2) / motorConfig.slots;
            for (let i = 0; i < motorConfig.slots; i++) {
                const angle = i * slotAngle;
                const slotX = centerX + Math.cos(angle) * ((outerRadius + innerRadius) / 2);
                const slotY = centerY + Math.sin(angle) * ((outerRadius + innerRadius) / 2);

                // ã‚¹ãƒ­ãƒƒãƒˆ
                motorCtx.beginPath();
                motorCtx.arc(slotX, slotY, 15, 0, Math.PI * 2);
                motorCtx.fillStyle = '#fff';
                motorCtx.fill();
                motorCtx.strokeStyle = '#666';
                motorCtx.lineWidth = 1;
                motorCtx.stroke();

                // ã‚³ã‚¤ãƒ«ã®è¡¨ç¾
                const coilPhase = i % 3; // 3ç›¸
                const coilColors = ['#ff6b6b', '#4ecdc4', '#ffe66d'];
                
                if (motorConfig.windingType === 'concentrated') {
                    // é›†ä¸­å·»: å„ã‚¹ãƒ­ãƒƒãƒˆã«ç‹¬ç«‹ã—ãŸã‚³ã‚¤ãƒ«
                    motorCtx.beginPath();
                    motorCtx.arc(slotX, slotY, 12, 0, Math.PI * 2);
                    motorCtx.fillStyle = coilColors[coilPhase];
                    motorCtx.fill();
                } else {
                    // åˆ†å¸ƒå·»: éš£æ¥ã‚¹ãƒ­ãƒƒãƒˆã«ã¾ãŸãŒã‚‹ã‚³ã‚¤ãƒ«
                    motorCtx.beginPath();
                    const nextAngle = (i + 1) * slotAngle;
                    const nextX = centerX + Math.cos(nextAngle) * ((outerRadius + innerRadius) / 2);
                    const nextY = centerY + Math.sin(nextAngle) * ((outerRadius + innerRadius) / 2);
                    
                    motorCtx.moveTo(slotX, slotY);
                    motorCtx.quadraticCurveTo(centerX, centerY, nextX, nextY);
                    motorCtx.strokeStyle = coilColors[coilPhase];
                    motorCtx.lineWidth = 3;
                    motorCtx.stroke();
                    
                    motorCtx.beginPath();
                    motorCtx.arc(slotX, slotY, 8, 0, Math.PI * 2);
                    motorCtx.fillStyle = coilColors[coilPhase];
                    motorCtx.fill();
                }

                // å·»ãæ•°ã®è¦–è¦šè¡¨ç¾(ç·šã®å¤ªã•)
                const thickness = (motorConfig.turns / 100) * 2;
                motorCtx.strokeStyle = coilColors[coilPhase];
                motorCtx.lineWidth = thickness;
                motorCtx.beginPath();
                motorCtx.arc(slotX, slotY, 10, 0, Math.PI * 2);
                motorCtx.stroke();
            }

            // ãƒ­ãƒ¼ã‚¿(å›è»¢éƒ¨)
            motorCtx.save();
            motorCtx.translate(centerX, centerY);
            motorCtx.rotate(motorConfig.rotationAngle);

            // ãƒ­ãƒ¼ã‚¿ã‚³ã‚¢
            motorCtx.beginPath();
            motorCtx.arc(0, 0, rotorRadius, 0, Math.PI * 2);
            motorCtx.fillStyle = '#a0a0a0';
            motorCtx.fill();
            motorCtx.strokeStyle = '#333';
            motorCtx.lineWidth = 2;
            motorCtx.stroke();

            // æ°¸ä¹…ç£çŸ³(N/Sæ¥µ)
            const poleAngle = (Math.PI * 2) / motorConfig.poles;
            for (let i = 0; i < motorConfig.poles; i++) {
                const angle = i * poleAngle;
                const magnetRadius = rotorRadius * 0.7;
                const magnetX = Math.cos(angle) * magnetRadius;
                const magnetY = Math.sin(angle) * magnetRadius;

                motorCtx.beginPath();
                motorCtx.arc(magnetX, magnetY, 20, 0, Math.PI * 2);
                motorCtx.fillStyle = (i % 2 === 0) ? '#ff4444' : '#4444ff';
                motorCtx.fill();
                motorCtx.strokeStyle = '#fff';
                motorCtx.lineWidth = 2;
                motorCtx.stroke();

                // N/Sè¡¨ç¤º
                motorCtx.fillStyle = '#fff';
                motorCtx.font = 'bold 14px Arial';
                motorCtx.textAlign = 'center';
                motorCtx.textBaseline = 'middle';
                motorCtx.fillText((i % 2 === 0) ? 'N' : 'S', magnetX, magnetY);
            }

            // å›è»¢è»¸
            motorCtx.beginPath();
            motorCtx.arc(0, 0, 15, 0, Math.PI * 2);
            motorCtx.fillStyle = '#555';
            motorCtx.fill();

            motorCtx.restore();
        }

        // ç‰¹æ€§è¨ˆç®—
        function calculateCharacteristics() {
            const baseTorque = 1.0;
            const baseEfficiency = 90;
            const baseRipple = 8;
            const baseCopperLoss = 15;

            // å·»ç·šæ–¹å¼ã«ã‚ˆã‚‹å½±éŸ¿
            let torqueMultiplier = 1.0;
            let efficiencyModifier = 0;
            let rippleMultiplier = 1.0;

            if (motorConfig.windingType === 'concentrated') {
                efficiencyModifier = 2; // é›†ä¸­å·»ã¯åŠ¹ç‡ãŒé«˜ã„
                rippleMultiplier = 1.3; // ãƒªãƒƒãƒ—ãƒ«ã¯å¤§ãã„
                torqueMultiplier = 0.95;
            } else {
                efficiencyModifier = -3; // åˆ†å¸ƒå·»ã¯åŠ¹ç‡ãŒã‚„ã‚„ä½ã„
                rippleMultiplier = 0.5; // ãƒªãƒƒãƒ—ãƒ«ã¯å°ã•ã„
                torqueMultiplier = 1.1;
            }

            // å·»ãæ•°ã«ã‚ˆã‚‹å½±éŸ¿
            const turnsEffect = motorConfig.turns / 100;
            torqueMultiplier *= turnsEffect;

            // å¯†åº¦ã«ã‚ˆã‚‹å½±éŸ¿
            const densityEffect = motorConfig.density / 80;
            efficiencyModifier += (densityEffect - 1) * 5;

            // ã‚¹ãƒ­ãƒƒãƒˆ/æ¥µæ•°æ¯”ã«ã‚ˆã‚‹å½±éŸ¿
            const slotPoleRatio = motorConfig.slots / motorConfig.poles;
            if (slotPoleRatio >= 1.2 && slotPoleRatio <= 1.8) {
                rippleMultiplier *= 0.8; // æœ€é©ãªæ¯”ç‡
            } else {
                rippleMultiplier *= 1.2;
            }

            // é€Ÿåº¦ã«ã‚ˆã‚‹å½±éŸ¿
            const speedEffect = 1 - (motorConfig.speed / 3000) * 0.3;

            // æœ€çµ‚å€¤ã®è¨ˆç®—
            const torque = (baseTorque * torqueMultiplier * speedEffect).toFixed(2);
            const efficiency = Math.min(95, Math.max(75, baseEfficiency + efficiencyModifier + (densityEffect - 1) * 3)).toFixed(0);
            const ripple = (baseRipple * rippleMultiplier).toFixed(1);
            const copperLoss = (baseCopperLoss * (motorConfig.turns / 100) * (100 / motorConfig.density)).toFixed(0);

            return { torque, efficiency, ripple, copperLoss };
        }

        // çµ±è¨ˆå€¤ã®æ›´æ–°
        function updateStats() {
            const stats = calculateCharacteristics();
            document.getElementById('torqueValue').textContent = stats.torque;
            document.getElementById('efficiencyValue').textContent = stats.efficiency;
            document.getElementById('rippleValue').textContent = stats.ripple;
            document.getElementById('copperLossValue').textContent = stats.copperLoss;

            // æ¯”è¼ƒè¡¨ã®æ›´æ–°
            document.getElementById('currentTorqueDensity').textContent = 
                motorConfig.windingType === 'concentrated' ? 'ä¸­' : 'é«˜';
            document.getElementById('currentRippleLevel').textContent = 
                parseFloat(stats.ripple) > 7 ? 'å¤§' : 'å°';
            document.getElementById('currentEfficiencyLevel').textContent = 
                parseInt(stats.efficiency) > 88 ? 'é«˜' : 'ä¸­';
            document.getElementById('currentManufacturing').textContent = 
                motorConfig.windingType === 'concentrated' ? 'æ˜“' : 'é›£';
        }

        // ãƒˆãƒ«ã‚¯-é€Ÿåº¦ç‰¹æ€§ã‚°ãƒ©ãƒ•
        function drawTorqueSpeedChart() {
            const ctx = torqueSpeedCtx;
            const width = torqueSpeedCanvas.width;
            const height = torqueSpeedCanvas.height;
            const padding = 50;

            ctx.clearRect(0, 0, width, height);

            // è»¸ã®æç”»
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();

            // ãƒ©ãƒ™ãƒ«
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('å›è»¢é€Ÿåº¦ (rpm)', width / 2, height - 10);
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('ãƒˆãƒ«ã‚¯ (Nm)', 0, 0);
            ctx.restore();

            // ç›®ç››ã‚Š
            ctx.fillStyle = '#666';
            ctx.font = '10px Arial';
            for (let i = 0; i <= 5; i++) {
                const x = padding + (width - 2 * padding) * (i / 5);
                const speed = (3000 * i / 5).toFixed(0);
                ctx.fillText(speed, x, height - padding + 20);
                
                const y = height - padding - (height - 2 * padding) * (i / 5);
                const torque = (1.5 * i / 5).toFixed(1);
                ctx.textAlign = 'right';
                ctx.fillText(torque, padding - 10, y + 5);
            }

            // ãƒˆãƒ«ã‚¯-é€Ÿåº¦æ›²ç·š
            const stats = calculateCharacteristics();
            const baseTorque = parseFloat(stats.torque) * (3000 / motorConfig.speed);

            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();

            for (let speed = 0; speed <= 3000; speed += 50) {
                const torque = baseTorque * (1 - speed / 3000 * 0.3);
                const x = padding + (width - 2 * padding) * (speed / 3000);
                const y = height - padding - (height - 2 * padding) * (torque / 1.5);
                
                if (speed === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();

            // ç¾åœ¨ã®å‹•ä½œç‚¹
            const currentX = padding + (width - 2 * padding) * (motorConfig.speed / 3000);
            const currentTorque = parseFloat(stats.torque);
            const currentY = height - padding - (height - 2 * padding) * (currentTorque / 1.5);
            
            ctx.beginPath();
            ctx.arc(currentX, currentY, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#ff4444';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // ãƒˆãƒ«ã‚¯ãƒªãƒƒãƒ—ãƒ«æ³¢å½¢
        function drawRippleChart() {
            const ctx = rippleCtx;
            const width = rippleCanvas.width;
            const height = rippleCanvas.height;
            const padding = 50;

            ctx.clearRect(0, 0, width, height);

            // è»¸ã®æç”»
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();

            // ãƒ©ãƒ™ãƒ«
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('å›è»¢è§’åº¦ (åº¦)', width / 2, height - 10);
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('ãƒˆãƒ«ã‚¯å¤‰å‹• (%)', 0, 0);
            ctx.restore();

            // ç›®ç››ã‚Š
            ctx.fillStyle = '#666';
            ctx.font = '10px Arial';
            for (let i = 0; i <= 4; i++) {
                const x = padding + (width - 2 * padding) * (i / 4);
                const angle = (360 * i / 4).toFixed(0);
                ctx.fillText(angle, x, height - padding + 20);
            }

            for (let i = 0; i <= 4; i++) {
                const y = height - padding - (height - 2 * padding) * (i / 4);
                const value = (-10 + 20 * i / 4).toFixed(0);
                ctx.textAlign = 'right';
                ctx.fillText(value, padding - 10, y + 5);
            }

            // åŸºæº–ç·š
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            const midY = height - padding - (height - 2 * padding) * 0.5;
            ctx.moveTo(padding, midY);
            ctx.lineTo(width - padding, midY);
            ctx.stroke();
            ctx.setLineDash([]);

            // ãƒªãƒƒãƒ—ãƒ«æ³¢å½¢
            const stats = calculateCharacteristics();
            const rippleAmplitude = parseFloat(stats.ripple);
            const harmonics = motorConfig.windingType === 'concentrated' ? 3 : 1;

            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 2;
            ctx.beginPath();

            for (let angle = 0; angle <= 360; angle += 2) {
                let ripple = 0;
                
                // åŸºæœ¬æ³¢
                ripple += Math.sin(angle * Math.PI / 180 * motorConfig.poles) * rippleAmplitude;
                
                // é«˜èª¿æ³¢æˆåˆ†(é›†ä¸­å·»ã¯å¤šã„)
                if (motorConfig.windingType === 'concentrated') {
                    ripple += Math.sin(angle * Math.PI / 180 * motorConfig.poles * 3) * rippleAmplitude * 0.3;
                    ripple += Math.sin(angle * Math.PI / 180 * motorConfig.poles * 5) * rippleAmplitude * 0.15;
                }

                const x = padding + (width - 2 * padding) * (angle / 360);
                const y = height - padding - (height - 2 * padding) * ((ripple + 10) / 20);
                
                if (angle === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
        }

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function startAnimation() {
            function animate() {
                if (!motorConfig.isRunning) return;
                
                motorConfig.rotationAngle += (motorConfig.speed / 1000) * 0.1;
                if (motorConfig.rotationAngle > Math.PI * 2) {
                    motorConfig.rotationAngle -= Math.PI * 2;
                }
                
                drawMotor();
                animationId = requestAnimationFrame(animate);
            }
            animate();
        }

        function stopAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            motorConfig.isRunning = false;
        }

        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
        function updateSimulation() {
            drawMotor();
            updateStats();
            drawTorqueSpeedChart();
            drawRippleChart();
            drawWindingDiagrams();
        }

        // 2Då·»ç·šãƒ‘ã‚¿ãƒ¼ãƒ³å›³ã®æç”»
        function drawWindingDiagrams() {
            drawConcentratedWindingDiagram();
            drawDistributedWindingDiagram();
            drawCurrentWindingDiagram();
        }

        // é›†ä¸­å·»ã®2Då±•é–‹å›³
        function drawConcentratedWindingDiagram() {
            const canvas = document.getElementById('concentratedWindingDiagram');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const slotCount = 12;
            const slotWidth = (width - 100) / slotCount;
            const startX = 50;
            const teethY = height / 2;
            
            // ãƒ†ã‚£ãƒ¼ã‚¹(æ­¯)ã®æç”»
            for (let i = 0; i < slotCount; i++) {
                const x = startX + i * slotWidth;
                
                // ãƒ†ã‚£ãƒ¼ã‚¹
                ctx.fillStyle = '#d0d0d0';
                ctx.fillRect(x, teethY - 40, slotWidth * 0.6, 80);
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;
                ctx.strokeRect(x, teethY - 40, slotWidth * 0.6, 80);
                
                // ã‚³ã‚¤ãƒ«(3ç›¸ã§è‰²åˆ†ã‘)
                const phase = i % 3;
                const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d'];
                const phaseNames = ['U', 'V', 'W'];
                
                // ã‚³ã‚¤ãƒ«ã®å·»ãç·šè¡¨ç¾
                ctx.strokeStyle = colors[phase];
                ctx.lineWidth = 6;
                ctx.lineCap = 'round';
                
                // ä¸Šéƒ¨ã®å·»ã
                ctx.beginPath();
                ctx.arc(x + slotWidth * 0.3, teethY - 30, 15, Math.PI, 0);
                ctx.stroke();
                
                // ä¸‹éƒ¨ã®å·»ã
                ctx.beginPath();
                ctx.arc(x + slotWidth * 0.3, teethY + 30, 15, 0, Math.PI);
                ctx.stroke();
                
                // ç›¸ã®è¡¨ç¤º
                ctx.fillStyle = '#333';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(phaseNames[phase], x + slotWidth * 0.3, teethY + 5);
            }
            
            // èª¬æ˜çŸ¢å°ã¨æ–‡å­—
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(startX + slotWidth * 0.3, teethY - 60);
            ctx.lineTo(startX + slotWidth * 0.3, 20);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 11px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('1ãƒ†ã‚£ãƒ¼ã‚¹1ã‚³ã‚¤ãƒ«', startX + slotWidth * 0.3, 15);
        }

        // åˆ†å¸ƒå·»ã®2Då±•é–‹å›³
        function drawDistributedWindingDiagram() {
            const canvas = document.getElementById('distributedWindingDiagram');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const slotCount = 12;
            const slotWidth = (width - 100) / slotCount;
            const startX = 50;
            const teethY = height / 2;
            
            // ãƒ†ã‚£ãƒ¼ã‚¹(æ­¯)ã®æç”»
            for (let i = 0; i < slotCount; i++) {
                const x = startX + i * slotWidth;
                
                ctx.fillStyle = '#d0d0d0';
                ctx.fillRect(x, teethY - 40, slotWidth * 0.6, 80);
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;
                ctx.strokeRect(x, teethY - 40, slotWidth * 0.6, 80);
            }
            
            // åˆ†å¸ƒå·»ã‚³ã‚¤ãƒ«ã®æç”»(è¤‡æ•°ãƒ†ã‚£ãƒ¼ã‚¹ã«ã¾ãŸãŒã‚‹)
            const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d'];
            const phaseNames = ['U', 'V', 'W'];
            
            // Uç›¸ã‚³ã‚¤ãƒ«(ã‚¹ãƒ­ãƒƒãƒˆ0-1-2ã«ã¾ãŸãŒã‚‹)
            ctx.strokeStyle = colors[0];
            ctx.lineWidth = 5;
            ctx.beginPath();
            const u1 = startX + 0.5 * slotWidth;
            const u2 = startX + 2.5 * slotWidth;
            ctx.moveTo(u1, teethY - 50);
            ctx.bezierCurveTo(u1, teethY - 80, u2, teethY - 80, u2, teethY - 50);
            ctx.moveTo(u1, teethY + 50);
            ctx.bezierCurveTo(u1, teethY + 80, u2, teethY + 80, u2, teethY + 50);
            ctx.stroke();
            
            // Vç›¸ã‚³ã‚¤ãƒ«(ã‚¹ãƒ­ãƒƒãƒˆ4-5-6ã«ã¾ãŸãŒã‚‹)
            ctx.strokeStyle = colors[1];
            ctx.beginPath();
            const v1 = startX + 4.5 * slotWidth;
            const v2 = startX + 6.5 * slotWidth;
            ctx.moveTo(v1, teethY - 50);
            ctx.bezierCurveTo(v1, teethY - 80, v2, teethY - 80, v2, teethY - 50);
            ctx.moveTo(v1, teethY + 50);
            ctx.bezierCurveTo(v1, teethY + 80, v2, teethY + 80, v2, teethY + 50);
            ctx.stroke();
            
            // Wç›¸ã‚³ã‚¤ãƒ«(ã‚¹ãƒ­ãƒƒãƒˆ8-9-10ã«ã¾ãŸãŒã‚‹)
            ctx.strokeStyle = colors[2];
            ctx.beginPath();
            const w1 = startX + 8.5 * slotWidth;
            const w2 = startX + 10.5 * slotWidth;
            ctx.moveTo(w1, teethY - 50);
            ctx.bezierCurveTo(w1, teethY - 80, w2, teethY - 80, w2, teethY - 50);
            ctx.moveTo(w1, teethY + 50);
            ctx.bezierCurveTo(w1, teethY + 80, w2, teethY + 80, w2, teethY + 50);
            ctx.stroke();
            
            // ç›¸ã®è¡¨ç¤º
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('U', (u1 + u2) / 2, teethY + 5);
            ctx.fillText('V', (v1 + v2) / 2, teethY + 5);
            ctx.fillText('W', (w1 + w2) / 2, teethY + 5);
            
            // èª¬æ˜çŸ¢å°ã¨æ–‡å­—
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(u1, teethY - 90);
            ctx.lineTo(u2, teethY - 90);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // çŸ¢å°ã®ç«¯
            ctx.beginPath();
            ctx.moveTo(u1, teethY - 95);
            ctx.lineTo(u1, teethY - 85);
            ctx.moveTo(u2, teethY - 95);
            ctx.lineTo(u2, teethY - 85);
            ctx.stroke();
            
            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 11px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('è¤‡æ•°ãƒ†ã‚£ãƒ¼ã‚¹ã«åˆ†æ•£', (u1 + u2) / 2, teethY - 95);
        }

        // ç¾åœ¨ã®è¨­å®šã®å·»ç·šãƒ‘ã‚¿ãƒ¼ãƒ³å±•é–‹å›³
        function drawCurrentWindingDiagram() {
            const canvas = document.getElementById('currentWindingDiagram');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const slotCount = motorConfig.slots;
            const slotWidth = (width - 100) / slotCount;
            const startX = 50;
            const teethY = height / 2;
            
            // ã‚¿ã‚¤ãƒˆãƒ«
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`ã‚¹ãƒ­ãƒƒãƒˆæ•°: ${slotCount}ã€ç£æ¥µæ•°: ${motorConfig.poles}ã€å·»ãæ•°: ${motorConfig.turns}ã‚¿ãƒ¼ãƒ³`, 10, 20);
            ctx.fillText(`å·»ç·šæ–¹å¼: ${motorConfig.windingType === 'concentrated' ? 'é›†ä¸­å·»' : 'åˆ†å¸ƒå·»'}`, 10, 40);
            
            // ãƒ†ã‚£ãƒ¼ã‚¹(æ­¯)ã®æç”»
            for (let i = 0; i < slotCount; i++) {
                const x = startX + i * slotWidth;
                
                // ãƒ†ã‚£ãƒ¼ã‚¹
                ctx.fillStyle = '#d0d0d0';
                ctx.fillRect(x, teethY - 50, slotWidth * 0.5, 100);
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;
                ctx.strokeRect(x, teethY - 50, slotWidth * 0.5, 100);
                
                // ã‚¹ãƒ­ãƒƒãƒˆç•ªå·
                ctx.fillStyle = '#999';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(i.toString(), x + slotWidth * 0.25, teethY + 70);
            }
            
            const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d'];
            const phaseNames = ['U', 'V', 'W'];
            
            if (motorConfig.windingType === 'concentrated') {
                // é›†ä¸­å·»ã®æç”»
                for (let i = 0; i < slotCount; i++) {
                    const x = startX + i * slotWidth;
                    const phase = i % 3;
                    
                    // ã‚³ã‚¤ãƒ«ã®å¤ªã•ã‚’å·»ãæ•°ã«å¿œã˜ã¦å¤‰åŒ–
                    const coilThickness = Math.max(3, (motorConfig.turns / 100) * 5);
                    
                    ctx.strokeStyle = colors[phase];
                    ctx.lineWidth = coilThickness;
                    ctx.lineCap = 'round';
                    
                    // ä¸Šéƒ¨ã®å·»ã
                    ctx.beginPath();
                    const radius = Math.min(18, slotWidth * 0.25);
                    ctx.arc(x + slotWidth * 0.25, teethY - 35, radius, Math.PI, 0);
                    ctx.stroke();
                    
                    // ä¸‹éƒ¨ã®å·»ã
                    ctx.beginPath();
                    ctx.arc(x + slotWidth * 0.25, teethY + 35, radius, 0, Math.PI);
                    ctx.stroke();
                    
                    // ã‚³ã‚¤ãƒ«å¯†åº¦ã®è¡¨ç¾(é‡ã­å·»ã)
                    const densityLayers = Math.floor(motorConfig.density / 30);
                    for (let layer = 1; layer <= densityLayers; layer++) {
                        ctx.lineWidth = coilThickness * 0.6;
                        ctx.globalAlpha = 0.3;
                        
                        ctx.beginPath();
                        ctx.arc(x + slotWidth * 0.25, teethY - 35 - layer * 2, radius, Math.PI, 0);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.arc(x + slotWidth * 0.25, teethY + 35 + layer * 2, radius, 0, Math.PI);
                        ctx.stroke();
                    }
                    ctx.globalAlpha = 1.0;
                    
                    // ç›¸ã®è¡¨ç¤º
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'center';
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 3;
                    ctx.strokeText(phaseNames[phase], x + slotWidth * 0.25, teethY + 5);
                    ctx.fillText(phaseNames[phase], x + slotWidth * 0.25, teethY + 5);
                }
            } else {
                // åˆ†å¸ƒå·»ã®æç”»
                const coilsPerPhase = Math.floor(slotCount / 3);
                const coilThickness = Math.max(3, (motorConfig.turns / 100) * 4);
                
                for (let phase = 0; phase < 3; phase++) {
                    ctx.strokeStyle = colors[phase];
                    ctx.lineWidth = coilThickness;
                    
                    for (let coilIdx = 0; coilIdx < coilsPerPhase / 2; coilIdx++) {
                        const startSlot = phase * coilsPerPhase + coilIdx;
                        const endSlot = startSlot + 2; // 2ã‚¹ãƒ­ãƒƒãƒˆåˆ†ã«ã¾ãŸãŒã‚‹
                        
                        if (endSlot < slotCount) {
                            const x1 = startX + startSlot * slotWidth + slotWidth * 0.25;
                            const x2 = startX + endSlot * slotWidth + slotWidth * 0.25;
                            
                            // ä¸Šéƒ¨ã®ã‚³ã‚¤ãƒ«æ¥ç¶š
                            ctx.beginPath();
                            ctx.moveTo(x1, teethY - 50);
                            ctx.bezierCurveTo(
                                x1, teethY - 70 - coilIdx * 10,
                                x2, teethY - 70 - coilIdx * 10,
                                x2, teethY - 50
                            );
                            ctx.stroke();
                            
                            // ä¸‹éƒ¨ã®ã‚³ã‚¤ãƒ«æ¥ç¶š
                            ctx.beginPath();
                            ctx.moveTo(x1, teethY + 50);
                            ctx.bezierCurveTo(
                                x1, teethY + 70 + coilIdx * 10,
                                x2, teethY + 70 + coilIdx * 10,
                                x2, teethY + 50
                            );
                            ctx.stroke();
                            
                            // ç›¸ã®è¡¨ç¤º
                            ctx.fillStyle = '#fff';
                            ctx.font = 'bold 10px Arial';
                            ctx.textAlign = 'center';
                            ctx.strokeStyle = '#333';
                            ctx.lineWidth = 2;
                            const midX = (x1 + x2) / 2;
                            ctx.strokeText(phaseNames[phase], midX, teethY + 5);
                            ctx.fillStyle = colors[phase];
                            ctx.fillText(phaseNames[phase], midX, teethY + 5);
                        }
                    }
                }
            }
            
            // ç£æ¥µä½ç½®ã®è¡¨ç¤º
            const poleWidth = width / motorConfig.poles;
            ctx.fillStyle = 'rgba(102, 126, 234, 0.1)';
            for (let i = 0; i < motorConfig.poles; i++) {
                if (i % 2 === 0) {
                    ctx.fillRect(i * poleWidth, teethY - 60, poleWidth, 10);
                }
            }
            
            // ç£æ¥µã®èª¬æ˜
            ctx.fillStyle = '#667eea';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('N', poleWidth / 2, teethY - 53);
            ctx.fillText('S', poleWidth * 1.5, teethY - 53);
            
            ctx.fillStyle = '#999';
            ctx.font = '9px Arial';
            ctx.fillText('(ãƒ­ãƒ¼ã‚¿ç£æ¥µä½ç½®)', width / 2, teethY - 65);
        }

        // åˆæœŸåŒ–
        updateSimulation();
        drawWindingDiagrams();
    </script>
</body>
</html>
